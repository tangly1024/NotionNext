# NotionNext ç‰ˆæœ¬æ›´æ–°æŒ‡å—

æœ¬æŒ‡å—å¸®åŠ©æ‚¨å®‰å…¨åœ°å°†åšå®¢æ›´æ–°åˆ°ä¸Šæ¸¸æœ€æ–°ç‰ˆæœ¬ï¼ŒåŒæ—¶ä¿ç•™æ‰€æœ‰ä¸ªæ€§åŒ–é…ç½®ã€‚

æŒ‰ç…§ä»¥ä¸‹æµç¨‹æ“ä½œï¼Œæ‚¨å¯ä»¥ï¼š
- âœ… è·å– NotionNext çš„æœ€æ–°åŠŸèƒ½å’Œä¿®å¤
- âœ… ä¿ç•™æ‚¨çš„ä¸ªäººé…ç½®ï¼ˆå¤´åƒã€æ ‡é¢˜ã€åŸŸåç­‰ï¼‰
- âœ… å®‰å…¨å¤„ç†å¯èƒ½çš„ä»£ç å†²çª

> âš ï¸ æœ¬æŒ‡å—é€‚ç”¨äº Vercel éƒ¨ç½²åœºæ™¯ï¼Œå…¶ä»–å¹³å°æœªæµ‹è¯•ã€‚

## åˆ†æ”¯ç®¡ç†ç­–ç•¥

æœ¬ç­–ç•¥å‚è€ƒ [NotionNext å®˜æ–¹å‡çº§æ•™ç¨‹](https://docs.tangly1024.com/article/how-to-update-notionnext) ä¸­çš„å»ºè®®ï¼Œä½¿ç”¨åŒåˆ†æ”¯ç®¡ç†æ¨¡å¼ã€‚

### åˆ†æ”¯è¯´æ˜

| åˆ†æ”¯ | ç”¨é€” | æ›´æ–°ç­–ç•¥ | éƒ¨ç½²çŠ¶æ€ |
|------|------|----------|----------|
| `main` | åŒæ­¥ä¸Šæ¸¸åŸå§‹ä»£ç  | å¿«è¿›åˆå¹¶ | ä¸éƒ¨ç½² |
| `deploy` | ç”Ÿäº§ç¯å¢ƒä»£ç  | åˆå¹¶ main + ä¿ç•™ä¸ªæ€§åŒ– | Vercel è‡ªåŠ¨éƒ¨ç½² |
| `feature/*` | åŠŸèƒ½å¼€å‘ | åŸºäº deploy åˆ›å»º | ä¸éƒ¨ç½² |

### æ¶æ„ç¤ºæ„

```
GitHub Fork Repository
â”œâ”€â”€ main (åŒæ­¥ tangly1024/NotionNext)
â”œâ”€â”€ deploy (ç”Ÿäº§åˆ†æ”¯ â†’ Vercel)
â””â”€â”€ feature/* (å¼€å‘åˆ†æ”¯)
```

## å‰ç½®å‡†å¤‡

### 1. é…ç½® Vercel ç”Ÿäº§åˆ†æ”¯ï¼ˆé‡è¦ï¼‰

åœ¨ Vercel ä¸­å°†ç”Ÿäº§åˆ†æ”¯è®¾ç½®ä¸º `deploy`ï¼š

1. ç™»å½• [Vercel Dashboard](https://vercel.com)
2. è¿›å…¥ä½ çš„ NotionNext é¡¹ç›®
3. ç‚¹å‡» **Settings** â†’ **Git**
4. æ‰¾åˆ° **Production Branch** è®¾ç½®
5. å°†é»˜è®¤çš„ `main` æ”¹ä¸º `deploy`
6. ä¿å­˜è®¾ç½®

> ğŸ’¡ è¿™æ ·é…ç½®åï¼Œåªæœ‰ `deploy` åˆ†æ”¯çš„æ›´æ–°ä¼šè§¦å‘ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ï¼Œ`main` åˆ†æ”¯ä»…ç”¨äºåŒæ­¥ä¸Šæ¸¸ã€‚

### 2. é…ç½®ä¸Šæ¸¸ä»“åº“ï¼ˆä»…é¦–æ¬¡ï¼‰

```bash
# æ·»åŠ ä¸Šæ¸¸ä»“åº“
git remote add upstream https://github.com/tangly1024/NotionNext.git

# éªŒè¯é…ç½®
git remote -v
```

é¢„æœŸè¾“å‡ºï¼š
```
origin    https://github.com/[ä½ çš„ç”¨æˆ·å]/NotionNext.git (fetch)
origin    https://github.com/[ä½ çš„ç”¨æˆ·å]/NotionNext.git (push)
upstream  https://github.com/tangly1024/NotionNext.git (fetch)
upstream  https://github.com/tangly1024/NotionNext.git (push)
```

> âš ï¸ å¦‚æœæ²¡æœ‰çœ‹åˆ° upstream è¡Œï¼Œè¯´æ˜ä¸Šæ¸¸ä»“åº“æœªæˆåŠŸæ·»åŠ 

### 3. è¯†åˆ«ä¸ªæ€§åŒ–æ–‡ä»¶

æ›´æ–°å‰å…ˆäº†è§£ä½ çš„ä¸ªæ€§åŒ–ä¿®æ”¹ï¼š

```bash
# æŸ¥çœ‹ä¸ªæ€§åŒ–ä¿®æ”¹æ–‡ä»¶åˆ—è¡¨
git diff --name-only main..deploy
```

å¸¸è§ä¸ªæ€§åŒ–æ–‡ä»¶ï¼š
- `blog.config.js` - åšå®¢é…ç½®
- `public/avatar.png` - å¤´åƒ
- `public/favicon.ico` - ç½‘ç«™å›¾æ ‡
- `pages/_app.js` - å…¨å±€è„šæœ¬
- `.env.local` - ç¯å¢ƒå˜é‡

## æ ‡å‡†æ›´æ–°æµç¨‹

### æ­¥éª¤ 1ï¼šåŒæ­¥ main åˆ†æ”¯

```bash
# 1.1 åˆ‡æ¢åˆ° main åˆ†æ”¯
git checkout main

# 1.2 æ‹‰å–æœ¬åœ°æœ€æ–°ï¼ˆé˜²æ­¢å¤šè®¾å¤‡ä¸åŒæ­¥ï¼‰
git pull origin main

# 1.3 è·å–ä¸Šæ¸¸æ›´æ–°
git fetch upstream

# 1.4 åˆå¹¶ä¸Šæ¸¸ä»£ç 
git merge upstream/main

# 1.5 æ¨é€åˆ°è‡ªå·±çš„ä»“åº“
git push origin main
```

### æ­¥éª¤ 2ï¼šæ›´æ–° deploy åˆ†æ”¯

```bash
# 2.1 åˆ‡æ¢åˆ° deploy åˆ†æ”¯
git checkout deploy

# 2.2 ã€é‡è¦ã€‘åŒæ­¥è¿œç¨‹ deploy åˆ†æ”¯
git pull origin deploy

# 2.3 åˆå¹¶ main åˆ†æ”¯çš„æ›´æ–°
git merge main
```

### æ­¥éª¤ 3ï¼šå¤„ç†å†²çª

å¦‚æœå‡ºç°å†²çªï¼Œæ ¹æ®æ–‡ä»¶ç±»å‹å¤„ç†ï¼š

| æ–‡ä»¶ç±»å‹ | å¤„ç†ç­–ç•¥ | Git å‘½ä»¤ |
|----------|----------|----------|
| `yarn.lock` | æ¥å—ä¸Šæ¸¸ç‰ˆæœ¬ | `git checkout --theirs yarn.lock` |
| `blog.config.js` | æ‰‹åŠ¨åˆå¹¶ | ä¿ç•™ä¸ªäººé…ç½®ï¼Œæ·»åŠ æ–°é…ç½®é¡¹ |
| `public/avatar.png` | ä¿ç•™æœ¬åœ°ç‰ˆæœ¬ | `git checkout --ours public/avatar.png` |
| `public/favicon.*` | ä¿ç•™æœ¬åœ°ç‰ˆæœ¬ | `git checkout --ours public/favicon.*` |

å¤„ç†å®Œæˆåï¼š

```bash
# æ·»åŠ å·²è§£å†³çš„æ–‡ä»¶
git add .

# æäº¤åˆå¹¶
git commit -m "merge: åŒæ­¥ä¸Šæ¸¸æ›´æ–°

- ä¿ç•™ä¸ªæ€§åŒ–é…ç½®
- è§£å†³å†²çªæ–‡ä»¶: [æ–‡ä»¶åˆ—è¡¨]"
```

### æ­¥éª¤ 4ï¼šæ›´æ–°ä¾èµ–å¹¶æµ‹è¯•

```bash
# 4.1 æ¸…ç†å¹¶é‡æ–°å®‰è£…ä¾èµ–
rm -rf node_modules
yarn install

# 4.2 æœ¬åœ°æµ‹è¯•
yarn dev
# è®¿é—® http://localhost:3000 ç¡®è®¤æ­£å¸¸

# 4.3 æ„å»ºæµ‹è¯•
yarn build

# 4.4 æ¨é€åˆ°è¿œç¨‹
git push origin deploy
```

## è‡ªåŠ¨åŒ–è„šæœ¬

é¡¹ç›®æä¾›äº†è‡ªåŠ¨åŒ–æ›´æ–°è„šæœ¬ `scripts/update.sh`ï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼š

- å‰ç½®æ¡ä»¶æ£€æŸ¥
- è‡ªåŠ¨å¤‡ä»½é…ç½®æ–‡ä»¶
- åˆ†æ”¯åŒæ­¥ä¸åˆå¹¶
- å®‰å…¨å†²çªå¤„ç†
- ä¾èµ–æ›´æ–°

### ä½¿ç”¨æ–¹æ³•

```bash
# èµ‹äºˆæ‰§è¡Œæƒé™ï¼ˆé¦–æ¬¡ï¼‰
chmod +x scripts/update.sh

# æ‰§è¡Œæ›´æ–°
./scripts/update.sh
```

è„šæœ¬ä¼šå¼•å¯¼ä½ å®Œæˆæ•´ä¸ªæ›´æ–°æµç¨‹ï¼Œé‡åˆ°éœ€è¦æ‰‹åŠ¨å¤„ç†çš„æƒ…å†µä¼šç»™å‡ºæ˜ç¡®æç¤ºã€‚

## å›æ»šæ“ä½œ

### æ–¹æ³•ä¸€ï¼šGit å›æ»š

```bash
# æŸ¥çœ‹æäº¤å†å²
git log --oneline -10

# å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
git reset --hard [commit-hash]

# å¼ºåˆ¶æ¨é€ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
git push origin deploy --force-with-lease
```

### æ–¹æ³•äºŒï¼šä» Vercel æ¢å¤

å¦‚æœè¯¯æ“ä½œè¦†ç›–äº†ä»£ç ï¼Œå¯ä»¥ä» Vercel çš„éƒ¨ç½²å†å²ä¸­æ¢å¤ï¼š

1. ç™»å½• Vercel Dashboard
2. è¿›å…¥é¡¹ç›® â†’ Deployments
3. æ‰¾åˆ°æ­£å¸¸çš„å†å²éƒ¨ç½²ï¼Œç‚¹å‡»å³ä¾§ä¸‰ä¸ªç‚¹
4. é€‰æ‹© "View Source" æŸ¥çœ‹å½“æ—¶çš„æºä»£ç 
5. ç‚¹å‡»å³ä¸Šè§’å¯è·³è½¬åˆ° GitHub å¯¹åº”ç‰ˆæœ¬

## æ•…éšœæ’æŸ¥

### Vercel éƒ¨ç½²å¤±è´¥

**é—®é¢˜**ï¼šæ¨é€å Vercel æ„å»ºå¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. æ£€æŸ¥ Vercel æ„å»ºæ—¥å¿—å®šä½å…·ä½“é”™è¯¯
2. å¦‚æœæ˜¯ä¾èµ–é—®é¢˜ï¼š
   ```bash
   rm -rf node_modules yarn.lock
   yarn install
   git add yarn.lock
   git commit -m "fix: é‡æ–°ç”Ÿæˆ yarn.lock"
   git push
   ```
3. å¦‚æœæ˜¯ç¯å¢ƒå˜é‡é—®é¢˜ï¼šæ£€æŸ¥ Vercel Dashboard â†’ Settings â†’ Environment Variables

### å¤§é‡æ–‡ä»¶å†²çª

**é—®é¢˜**ï¼šåˆå¹¶æ—¶å‡ºç°å¤§é‡å†²çªï¼Œéš¾ä»¥å¤„ç†

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# ä¸­æ­¢å½“å‰åˆå¹¶
git merge --abort

# æŸ¥çœ‹ä¸Šæ¸¸æœ€è¿‘çš„æäº¤
git log upstream/main --oneline -20

# åˆ†æ­¥åˆå¹¶ï¼ˆå…ˆåˆå¹¶è¾ƒæ—©çš„æäº¤ï¼‰
git merge [earlier-commit]
# è§£å†³å†²çªåç»§ç»­åˆå¹¶ä¸‹ä¸€ä¸ª
```

### æœ¬åœ°ä¸è¿œç¨‹ä¸åŒæ­¥

**é—®é¢˜**ï¼šæ¨é€æ—¶æç¤º rejected

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# å…ˆæ‹‰å–è¿œç¨‹æ›´æ–°
git pull origin deploy --rebase

# è§£å†³å¯èƒ½çš„å†²çªåæ¨é€
git push origin deploy
```

## æ³¨æ„äº‹é¡¹

1. **æ›´æ–°é¢‘ç‡**ï¼šå»ºè®®æ¯ 1-2 å‘¨æ£€æŸ¥ä¸€æ¬¡æ›´æ–°ï¼Œé‡è¦å®‰å…¨æ›´æ–°åº”ç«‹å³å¤„ç†
2. **å¤‡ä»½é‡è¦æ–‡ä»¶**ï¼šæ›´æ–°å‰å¤‡ä»½ `blog.config.js` å’Œå…¶ä»–ä¸ªæ€§åŒ–é…ç½®
3. **æµ‹è¯•éªŒè¯**ï¼šæ›´æ–°ååŠ¡å¿…åœ¨æœ¬åœ°æµ‹è¯•ï¼Œç¡®è®¤åŠŸèƒ½æ­£å¸¸å†éƒ¨ç½²
4. **è®°å½•ä¿®æ”¹**ï¼šå»ºè®®ç»´æŠ¤ä¸€ä»½ä¸ªæ€§åŒ–ä¿®æ”¹æ¸…å•ï¼Œä¾¿äºåç»­æ›´æ–°

## ç›¸å…³èµ„æº

- [NotionNext å®˜æ–¹ä»“åº“](https://github.com/tangly1024/NotionNext)
- [NotionNext æ–‡æ¡£](https://docs.tangly1024.com/)
- [Vercel æ–‡æ¡£](https://vercel.com/docs)

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼š0.1.0 | æœ€åæ›´æ–°ï¼š2025-08-19*